service: github-backup-aws-s3-service
useDotenv: true
provider:
  name: aws
  runtime: nodejs18.x
  stage: production
  region: us-east-2
  timeout: 600
functions:
  runBackup:
    handler: handler.runBackup
    environment:
      GITHUB_ACCESS_TOKEN: ${env:GITHUB_ACCESS_TOKEN}
      AWS_S3_ACCESS_KEY_ID: ${env:AWS_S3_ACCESS_KEY_ID}
      AWS_S3_ACCESS_SECRET_KEY: ${env:AWS_S3_ACCESS_SECRET_KEY}
      AWS_S3_BUCKET_NAME: ${env:AWS_S3_BUCKET_NAME}
      AWS_S3_STORAGE_CLASS: ${env:AWS_S3_STORAGE_CLASS}
      BACKUP_MODE: ${env:BACKUP_MODE}
      GITHUB_ORGANISATION: ${env:GITHUB_ORGANISATION}
      EXPIRE_THRESHOLD: ${env:EXPIRE_THRESHOLD}
    events:
      - schedule: ${opt:schedule-expression} # http://docs.aws.amazon.com/AmazonCloudWatch/latest/events/ScheduledEvents.html
